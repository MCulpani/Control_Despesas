<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gest√£o de Despesas Operacionais</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0f172a;color:#e5e7eb}
header{background:#020617;padding:14px 20px;display:flex;justify-content:space-between;align-items:center}
header button{margin-left:6px;padding:8px 14px;border:none;border-radius:8px;background:#38bdf8;font-weight:bold;cursor:pointer}
main{padding:20px}
.card{background:#111827;border-radius:14px;padding:18px;margin-bottom:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
label{font-size:12px;color:#9ca3af}
input,select{width:100%;min-height:42px;padding:10px;border-radius:8px;border:1px solid #374151;background:#020617;color:#e5e7eb}
button.action{margin-top:16px;padding:12px;border:none;border-radius:10px;background:#22c55e;font-weight:bold;cursor:pointer}
table{width:100%;border-collapse:collapse;font-size:13px;text-align:center}
th,td{padding:10px;border-bottom:1px solid #1f2933}
.badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:bold}
.ok{background:#14532d;color:#22c55e}
.pending{background:#422006;color:#facc15}
a{color:#38bdf8;text-decoration:none}
.btn-sm{padding:6px 10px;border:none;border-radius:6px;cursor:pointer;font-size:12px}
.edit{background:#2563eb;color:#fff}
.del{background:#dc2626;color:#fff}
</style>
</head>
<body>

<header>
  <h3>üìä Gest√£o de Despesas</h3>
  <div>
    <button onclick="mostrar('cadastro')">Nova</button>
    <button onclick="mostrar('despesas')">Despesas</button>
  </div>
</header>

<main>

<section id="cadastro" class="card">
<h3>Nova Despesa</h3>
<div class="grid">
  <div><label>Raz√£o Social Prestador</label><input id="razao"></div>
  <div><label>NF Cliente</label><input id="nfCliente"></div>
  <div><label>UF</label><input id="uf"></div>
  <div><label>Valor da NF-s</label><input type="number" id="valorNFS"></div>
  <div><label>Valor por DT</label><input type="number" id="valorDT"></div>
  <div><label>Tipo Ve√≠culo</label><input id="tipoVeiculo"></div>
  <div><label>N√∫mero DT</label><input id="numeroDT"></div>
  <div><label>Data Vencimento</label><input type="date" id="dataVencimento"></div>
  <div><label>Cliente</label><input id="cliente"></div>
  <div><label>Tipo Servi√ßo</label><input id="tipoServico"></div>
  <div><label>Embutimento</label><input id="embutimento"></div>
  <div><label>Motivo</label><input id="motivo"></div>
  <div><label>Fato Gerador</label><input id="fatoGerador"></div>
  <div><label>Observa√ß√µes</label><input id="observacoes"></div>
  <div><label>Status</label><select id="status"><option>Pendente</option><option>Aprovado</option></select></div>
  <div><label>Nota Fiscal</label><input type="file" id="nota"></div>
  <div><label>Comprovante Pagamento</label><input type="file" id="compPag"></div>
  <div><label>Comprovante Negocia√ß√£o</label><input type="file" id="compNeg"></div>
</div>
<button class="action" onclick="salvar()">Salvar Despesa</button>
</section>

<section id="despesas" class="card" style="display:none">
<h3>Despesas Cadastradas</h3>
<table>
<thead>
<tr>
<th>Raz√£o</th><th>NF</th><th>UF</th><th>Valor NF</th><th>Valor DT</th>
<th>Ve√≠culo</th><th>DT</th><th>Venc.</th><th>Cliente</th><th>Servi√ßo</th>
<th>Status</th><th>Nota</th><th>Pagto</th><th>Negocia√ß√£o</th><th>A√ß√µes</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</section>

</main>

<script>
let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');

function mostrar(id){
  document.getElementById('cadastro').style.display='none';
  document.getElementById('despesas').style.display='none';
  document.getElementById(id).style.display='block';
  if(id==='despesas') render();
}

function lerArquivo(file){
  return new Promise(res=>{
    if(!file) return res(null);
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

function salvar(){
  const fNota = document.getElementById('nota').files[0];
  if(!fNota){alert('Anexe a nota fiscal');return;}

  Promise.all([
    lerArquivo(fNota),
    lerArquivo(document.getElementById('compPag').files[0]),
    lerArquivo(document.getElementById('compNeg').files[0])
  ]).then(([nota,pag,neg])=>{
    despesas.push({
      razao:razao.value,
      nfCliente:nfCliente.value,
      uf:uf.value,
      valorNFS:valorNFS.value,
      valorDT:valorDT.value,
      tipoVeiculo:tipoVeiculo.value,
      numeroDT:numeroDT.value,
      dataVencimento:dataVencimento.value,
      cliente:cliente.value,
      tipoServico:tipoServico.value,
      status:status.value,
      nota, pag, neg
    });
    localStorage.setItem('despesas',JSON.stringify(despesas));
    alert('Despesa salva');
  });
}

function excluir(i){
  if(confirm('Deseja excluir esta despesa?')){
    despesas.splice(i,1);
    localStorage.setItem('despesas',JSON.stringify(despesas));
    render();
  }
}

function editar(i){
  alert('Edi√ß√£o simples: exclua e recadastre se necess√°rio.');
}

function render(){
  tbody.innerHTML='';
  despesas.forEach((d,i)=>{
    tbody.innerHTML+=`<tr>
      <td>${d.razao||''}</td><td>${d.nfCliente||''}</td><td>${d.uf||''}</td>
      <td>${d.valorNFS||''}</td><td>${d.valorDT||''}</td><td>${d.tipoVeiculo||''}</td>
      <td>${d.numeroDT||''}</td><td>${d.dataVencimento||''}</td><td>${d.cliente||''}</td>
      <td>${d.tipoServico||''}</td>
      <td><span class="badge ${d.status==='Aprovado'?'ok':'pending'}">${d.status}</span></td>
      <td>${d.nota?`<a href="${d.nota}" target="_blank">Abrir</a>`:'-'}</td>
      <td>${d.pag?`<a href="${d.pag}" target="_blank">Abrir</a>`:'-'}</td>
      <td>${d.neg?`<a href="${d.neg}" target="_blank">Abrir</a>`:'-'}</td>
      <td>
        <button class="btn-sm edit" onclick="editar(${i})">Editar</button>
        <button class="btn-sm del" onclick="excluir(${i})">Excluir</button>
      </td>
    </tr>`;
  });
}
</script>

</body>
</html>

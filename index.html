<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Gest√£o de Despesas Operacionais</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#e5e7eb}
header{background:#020617;padding:14px 20px;display:flex;justify-content:space-between;align-items:center}
header button{margin-left:6px;padding:8px 14px;border:none;border-radius:8px;background:#38bdf8;font-weight:bold;cursor:pointer}
main{padding:20px}
.card{background:#111827;border-radius:14px;padding:18px;margin-bottom:20px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;align-items:end}
label{font-size:12px;color:#9ca3af}
input,select{width:100%;min-height:42px;padding:10px;border-radius:8px;border:1px solid #374151;background:#020617;color:#e5e7eb}
button.action{margin-top:10px;padding:10px;border:none;border-radius:10px;background:#22c55e;font-weight:bold;cursor:pointer}
table{width:100%;border-collapse:collapse;font-size:13px;text-align:center}
th,td{padding:10px;border-bottom:1px solid #1f2933;text-align:center;vertical-align:middle}
.badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:bold}
.ok{background:#14532d;color:#22c55e}
.pending{background:#422006;color:#facc15}
canvas{max-height:240px;background:#020617;border-radius:12px;padding:6px}
</style>
</head>
<body>

<header>
  <h3>üìä Gest√£o de Despesas</h3>
  <div>
    <button onclick="showSection('cadastro')">Nova</button>
    <button onclick="showSection('lista')">Despesas</button>
    <button onclick="showSection('relatorios')">Relat√≥rios</button>
  </div>
</header>

<main>

<section id="cadastro" class="card">
<h3>Cadastro de Despesa</h3>
<div class="grid">
  <div><label>Raz√£o Social Prestador</label><input id="razao"></div>
  <div><label>NF Cliente</label><input id="nfCliente"></div>
  <div><label>UF</label><input id="uf"></div>
  <div><label>Valor da NF-s</label><input type="number" id="valorNFS" step="0.01"></div>
  <div><label>Valor por DT</label><input type="number" id="valorDT" step="0.01"></div>
  <div><label>Tipo de ve√≠culo</label><select id="tipoVeiculo"><option>Truck</option><option>Carreta</option><option>Bitrem</option><option>N/A</option></select></div>
  <div><label>N√∫mero DT</label><input id="numeroDT"></div>
  <div><label>Data Vencimento</label><input type="date" id="dataVencimento"></div>
  <div><label>Cliente</label><input id="cliente"></div>
  <div><label>Tipo de Servi√ßo</label><select id="tipoServico"><option>Taxa de Desembarque</option><option>Taxa de Embarque</option><option>Armazenagem</option><option>Travessia de Balsa</option><option>Descarga Manual</option><option>Redespacho</option><option>Descarga Maquin√°rio</option></select></div>
  <div><label>Embutimento?</label><select id="embutimento"><option>Sim</option><option>N√£o</option></select></div>
  <div><label>Motivo?</label><select id="motivo"><option>Sim</option><option>N√£o</option></select></div>
  <div><label>Fato gerador</label><input id="fatoGerador"></div>
  <div><label>Observa√ß√µes</label><input id="observacoes"></div>
  <div><label>Status</label><select id="status"><option>Pendente</option><option>Aprovado</option></select></div>
  <div><label>Nota fiscal (PDF)</label><input type="file" id="nota" accept="application/pdf,image/*"></div>
  <div><label>Comprovante Pagamento</label><input type="file" id="comprovantePagamento" accept="application/pdf,image/*"></div>
  <div><label>Comprovante Negocia√ß√£o</label><input type="file" id="comprovanteNegociacao" accept="application/pdf,image/*"></div>
</div>
<button class="action" onclick="salvarDespesa()">Salvar</button>
</section>

<section id="lista" class="card" style="display:none">
<h3>Despesas</h3>
<button onclick="exportarExcel()">üì• Excel</button>
<button onclick="exportarPDF()">üìÑ PDF</button>
<table>
<thead>
<tr>
<th>Raz√£o Social</th><th>NF Cliente</th><th>UF</th><th>Valor NF</th><th>Valor DT</th><th>Ve√≠culo</th><th>DT</th><th>Vencimento</th><th>Cliente</th><th>Servi√ßo</th><th>Embut.</th><th>Motivo</th><th>Fato Gerador</th><th>Observa√ß√µes</th><th>Status</th><th>Nota Fiscal</th><th>Comp. Pagto</th><th>Comp. Negocia√ß√£o</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</section>

<section id="relatorios" class="card" style="display:none">
<h3>Relat√≥rios</h3>
<p style="color:#9ca3af">(relat√≥rios ser√£o baseados nos valores salvos)</p>
</section>

</main>

<script>
let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');

function showSection(id){
  document.querySelectorAll('section').forEach(s=>s.style.display='none');
  document.getElementById(id).style.display='block';
  if(id==='lista') renderTabela();
}

function salvarDespesa(){
  const fileNota = document.getElementById('nota').files[0];
  const filePag  = document.getElementById('comprovantePagamento').files[0];
  const fileNeg  = document.getElementById('comprovanteNegociacao').files[0];

  if(!fileNota) return alert('Anexe a Nota Fiscal');

  const readFile = file => new Promise(resolve=>{
    if(!file) return resolve(null);
    const r = new FileReader();
    r.onload = () => resolve(r.result);
    r.readAsDataURL(file);
  });

  Promise.all([
    readFile(fileNota),
    readFile(filePag),
    readFile(fileNeg)
  ]).then(([nota, pag, neg])=>{
    const registro = {
      razao: document.getElementById('razao').value,
      nfCliente: document.getElementById('nfCliente').value,
      uf: document.getElementById('uf').value,
      valorNFS: document.getElementById('valorNFS').value,
      valorDT: document.getElementById('valorDT').value,
      tipoVeiculo: document.getElementById('tipoVeiculo').value,
      numeroDT: document.getElementById('numeroDT').value,
      dataVencimento: document.getElementById('dataVencimento').value,
      cliente: document.getElementById('cliente').value,
      tipoServico: document.getElementById('tipoServico').value,
      embutimento: document.getElementById('embutimento').value,
      motivo: document.getElementById('motivo').value,
      fatoGerador: document.getElementById('fatoGerador').value,
      observacoes: document.getElementById('observacoes').value,
      status: document.getElementById('status').value,
      nota: nota,
      comprovantePagamento: pag,
      comprovanteNegociacao: neg
    };

    despesas.push(registro);
    localStorage.setItem('despesas', JSON.stringify(despesas));
    alert('Despesa salva com sucesso');
  });
}

function renderTabela(){
  tbody.innerHTML='';
  despesas.forEach(d=>{
    tbody.innerHTML+=`<tr>
      <td>${d.razao}</td><td>${d.nfCliente}</td><td>${d.uf}</td>
      <td>${d.valorNFS}</td><td>${d.valorDT}</td><td>${d.tipoVeiculo}</td>
      <td>${d.numeroDT}</td><td>${d.dataVencimento}</td><td>${d.cliente}</td>
      <td>${d.tipoServico}</td><td>${d.embutimento}</td><td>${d.motivo}</td>
      <td>${d.fatoGerador}</td><td>${d.observacoes}</td>
      <td><span class="badge ${d.status==='Aprovado'?'ok':'pending'}">${d.status}</span></td>
      <td>${d.nota?`<a href="${d.nota}" target="_blank">Abrir</a>`:'-'}</td>
      <td>${d.comprovantePagamento?`<a href="${d.comprovantePagamento}" target="_blank">Abrir</a>`:'-'}</td>
      <td>${d.comprovanteNegociacao?`<a href="${d.comprovanteNegociacao}" target="_blank">Abrir</a>`:'-'}</td>
    </tr>`;
  });
}</td><td>${d.nfCliente}</td><td>${d.uf}</td>
      <td>${d.valorNFS}</td><td>${d.valorDT}</td><td>${d.tipoVeiculo}</td>
      <td>${d.numeroDT}</td><td>${d.dataVencimento}</td><td>${d.cliente}</td>
      <td>${d.tipoServico}</td><td>${d.embutimento}</td><td>${d.motivo}</td>
      <td>${d.fatoGerador}</td><td>${d.observacoes}</td>
      <td><span class="badge ${d.status==='Aprovado'?'ok':'pending'}">${d.status}</span></td>
      <td><a href="${d.nota}" target="_blank">PDF</a></td>
    </tr>`;
  });
}

function exportarExcel(){
  const ws=XLSX.utils.json_to_sheet(despesas);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,'Despesas');
  XLSX.writeFile(wb,'despesas.xlsx');
}

function exportarPDF(){
  const {jsPDF}=window.jspdf;const pdf=new jsPDF({orientation:'landscape'});
  let y=10;pdf.text('Relat√≥rio de Despesas',10,y);y+=10;
  despesas.forEach(d=>{pdf.text(`${d.razao} | ${d.nfCliente} | ${d.valorNFS}`,10,y);y+=8});
  pdf.save('despesas.pdf');
}
</script>

</body>
</html>

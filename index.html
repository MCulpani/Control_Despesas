<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gest√£o de Despesas Operacionais</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.29/dist/jspdf.plugin.autotable.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#e5e7eb}
header{background:#020617;padding:14px 20px;display:flex;justify-content:space-between}
header button{margin-left:6px;padding:8px 14px;border:none;border-radius:8px;background:#38bdf8;font-weight:bold;cursor:pointer}
main{padding:20px}
.card{background:#111827;border-radius:14px;padding:18px;margin-bottom:20px}

.grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px
}

.col-2{grid-column:span 2}
.col-3{grid-column:span 3}
.col-4{grid-column:span 4}

label{font-size:12px;color:#9ca3af}
input,select,textarea{
  width:100%;
  min-height:32px;
  padding:6px;
  border-radius:6px;
  border:1px solid #374151;
  background:#020617;
  color:#e5e7eb;
  font-size:12px
}

textarea{resize:none}

button.action{margin-top:16px;padding:12px;border:none;border-radius:10px;font-weight:bold;cursor:pointer}

table{width:100%;border-collapse:collapse;font-size:13px;text-align:center}
th,td{padding:8px;border-bottom:1px solid #1f2933}
.badge{padding:4px 8px;border-radius:6px;font-size:11px;font-weight:bold}
.ok{background:#14532d;color:#22c55e}
.pending{background:#422006;color:#facc15}

.btn-sm{padding:4px 8px;border:none;border-radius:6px;font-size:11px;cursor:pointer}
.edit{background:#2563eb;color:#fff}
.del{background:#dc2626;color:#fff}
.save{background:#16a34a;color:#fff}
.cancel{background:#6b7280;color:#fff}
</style>
</head>

<body>

<header>
  <h3>üìä Gest√£o de Despesas</h3>
  <div>
    <button onclick="mostrar('cadastro')">Nova</button>
    <button onclick="mostrar('despesas')">Despesas</button>
  </div>
</header>

<main>

<section id="cadastro" class="card">
<h3>Nova Despesa</h3>

<div class="grid">
  <div><label>Raz√£o Social</label><input id="razao"></div>
  <div><label>NF Cliente</label><input id="nfCliente"></div>
  <div><label>UF</label><input id="uf"></div>
  <div><label>Valor NF</label><input type="number" id="valorNFS"></div>

  <div><label>Valor DT</label><input type="number" id="valorDT"></div>
  <div><label>Ve√≠culo</label>
    <select id="tipoVeiculo">
      <option>Truck</option><option>Carreta</option><option>Bitrem</option><option>N/A</option>
    </select>
  </div>
  <div><label>N¬∫ DT</label><input id="numeroDT"></div>
  <div><label>Vencimento</label><input type="date" id="dataVencimento"></div>

  <div class="col-2"><label>Cliente</label><input id="cliente"></div>
  <div class="col-2"><label>Tipo Servi√ßo</label>
    <select id="tipoServico">
      <option>Taxa de Embarque</option><option>Taxa de Desembarque</option>
      <option>Armazenagem</option><option>Travessia</option>
    </select>
  </div>

  <div><label>Embutimento?</label><select id="embutimento"><option>Sim</option><option>N√£o</option></select></div>
  <div><label>Motivo?</label><select id="motivo"><option>Sim</option><option>N√£o</option></select></div>

  <div class="col-2"><label>Fato Gerador</label><input id="fatoGerador"></div>
  <div class="col-4"><label>Observa√ß√µes</label><input id="observacoes"></div>

  <div><label>Status</label><select id="status"><option>Pendente</option><option>Aprovado</option></select></div>
  <div><label>Nota Fiscal</label><input type="file" id="nota"></div>
  <div><label>Comprovante Pagto</label><input type="file" id="compPag"></div>
  <div><label>Negocia√ß√£o</label><input type="file" id="compNeg"></div>
</div>

<button class="action" style="background:#22c55e" onclick="salvar()">Salvar</button>
</section>

<section id="despesas" class="card" style="display:none">
<h3>Despesas Cadastradas</h3>
<table>
<thead>
<tr>
<th>Raz√£o</th><th>NF</th><th>Obs.</th><th>Status</th><th>A√ß√µes</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</section>

</main>

<script>
let despesas = JSON.parse(localStorage.getItem('despesas') || '[]');
let editRow = null;

function mostrar(id){
  cadastro.style.display='none';
  despesas.style.display='none';
  document.getElementById(id).style.display='block';
  if(id==='despesas') render();
}

function salvar(){
  despesas.push({
    razao:razao.value,
    nfCliente:nfCliente.value,
    observacoes:observacoes.value,
    status:status.value
  });
  localStorage.setItem('despesas',JSON.stringify(despesas));
  alert('Salvo');
}

function editar(i){editRow=i;render()}
function cancelar(){editRow=null;render()}

function salvarLinha(i){
  const row=document.querySelectorAll('[data-row="'+i+'"]');
  const keys=['razao','nfCliente','observacoes','status'];
  keys.forEach((k,idx)=>despesas[i][k]=row[idx].value);
  localStorage.setItem('despesas',JSON.stringify(despesas));
  editRow=null;render();
}

function render(){
  tbody.innerHTML='';
  despesas.forEach((d,i)=>{
    const e=editRow===i;
    tbody.innerHTML+=`
    <tr>
      <td>${e?`<input data-row="${i}" value="${d.razao}">`:d.razao}</td>
      <td>${e?`<input data-row="${i}" value="${d.nfCliente}">`:d.nfCliente}</td>
      <td>${e?`<textarea data-row="${i}" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'">${d.observacoes||''}</textarea>`:(d.observacoes||'')}</td>
      <td>${e?`<input data-row="${i}" value="${d.status}">`:d.status}</td>
      <td>
        ${e?`<button class="btn-sm save" onclick="salvarLinha(${i})">Salvar</button>
        <button class="btn-sm cancel" onclick="cancelar()">Cancelar</button>`:
        `<button class="btn-sm edit" onclick="editar(${i})">Editar</button>`}
      </td>
    </tr>`;
  });
}
</script>

</body>
</html>
